<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Bootstrap Simplifier</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  </head>
  <body>
    <form>
      <input id="input" type="text" placeholder="paste your class string here" size="100"/>
      <input type="submit" value="Simplify"/>
    </form>
    <pre id="output"></pre>
    <script>
      const inputBox = document.getElementById("input");
      inputBox.value = "text-center col-10 offset-1 col-sm-10 call-to-action offset-lg-0 offset-md-1 col-md-10 col-lg-4 col-xl-4";
      const outputBox = document.getElementById("output");
      const REGEX = /(?<type>col|offset)(-(?<breakpoint>sm|md|lg|xl))?-(?<value>\d+)/;

      document.getElementsByTagName("form")[0]
        .addEventListener("submit", function(event) {
          event.preventDefault();
          outputBox.textContent = simplify(inputBox.value);
        });

      const simplify = function removeRedundantElementsFromClassString(classString) {
        const simplifiedClassList = [];
        const bootstrapClasses = [];

        // Walk through the original class list
        classString.split(/\s/)
          .forEach(className => {
            if (REGEX.test(className)) {
              // This is a boostrap class, save for analysis
              bootstrapClasses.push(className);
            } else {
              // This is not a bootstrap class, it passes through
              simplifiedClassList.push(className);
            }
          });

        // Record the results of the regex, grouping by col/offset and breakpoint
        // Note that conflicts are last-one-wins: The poorly-coded class string
        // "col-md-3 col-md-6" is equivalent to just "col-md-6".
        const matchesByTypeAndBreakpoint = {};
        bootstrapClasses.map(className => REGEX.exec(className))
          .forEach(match => matchesByTypeAndBreakpoint[match.groups.type + (match.groups.breakpoint || "")] = match)

        // Keep track of the current col and offset widths
        const currentValues = {};
        ["", "sm", "md", "lg", "xl"].forEach(breakPoint => {
          ["col", "offset"].forEach(type => {
            let match = matchesByTypeAndBreakpoint[type + breakPoint];
            if (match) {
              currentValue = currentValues[type];
              newValue = parseInt(match.groups.value);
              if (currentValue !== newValue) {
                // Only preserve class names that cause a change
                currentValues[type] = newValue;
                simplifiedClassList.push(match.input);
              }
            }
          });
        });

        // Rebuild the string for outputting
        return simplifiedClassList.join(" ");
      }
    </script>
    <footer class="fixed-bottom">
        How does it work? Check out the <a href="https://github.com/benj2240/bootstrap-simplifier">github repository.</a>
    </footer>
  </body>
</html>
